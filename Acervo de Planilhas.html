<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acervo de Planilhas LAMIC</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body {
            background-color: #f9fafb;
            font-family: Arial, sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            background-color: #1e3a8a;
            color: white;
            padding: 16px 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        header img {
            height: 48px;
            margin-right: 16px;
        }
        header h1 {
            font-size: 24px;
            font-weight: bold;
        }
        nav {
            display: flex;
            gap: 8px;
        }
        .nav-item {
            padding: 8px 16px;
            border-radius: 6px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .nav-item:hover {
            background-color: #2b6cb0;
            transform: scale(1.05);
        }
        main {
            flex-grow: 1;
            padding: 32px 0;
        }
        .search-bar {
            max-width: 600px;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
        }
        .search-bar:focus {
            outline: none;
            border-color: #1e3a8a;
            box-shadow: 0 0 0 2px rgba(30, 58, 138, 0.5);
        }
        .dropdown {
            position: relative;
        }
        .dropdown-button {
            padding: 12px;
            background-color: #1e3a8a;
            color: white;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .dropdown-button:hover {
            background-color: #2b6cb0;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            z-index: 1;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .dropdown-content a {
            display: block;
            padding: 8px 16px;
            color: #1f2937;
            text-decoration: none;
        }
        .dropdown-content a:hover {
            background-color: #e5e7eb;
        }
        .modern-button {
            display: inline-block;
            padding: 12px 24px;
            background-color: #1e3a8a;
            color: white;
            border-radius: 6px;
            text-decoration: none;
            transition: background-color 0.3s ease, transform 0.2s ease;
            border: none;
            cursor: pointer;
        }
        .modern-button:hover {
            background-color: #2b6cb0;
            transform: scale(1.05);
        }
        .add-button {
            background-color: #16a34a;
        }
        .add-button:hover {
            background-color: #15803d;
        }
        .card {
            background-color: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .card h2 {
            font-size: 18px;
            font-weight: 600;
            color: #1e3a8a;
        }
        .card p {
            color: #6b7280;
        }
        .delete-button {
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .delete-button:hover {
            background-color: #dc2626;
        }
        .edit-button {
            background-color: transparent;
            color: #1e3a8a;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
            margin-right: 8px;
        }
        .edit-button:hover {
            color: #2b6cb0;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover,
        .close:focus {
            color: black;
        }
        .modal-content h2 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
        }
        .modal-content label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .modal-content input,
        .modal-content select {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            margin-bottom: 16px;
            box-sizing: border-box;
        }
        .modal-content button {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }
        .cancel-button {
            background-color: #d1d5db;
        }
        .cancel-button:hover {
            background-color: #9ca3af;
        }
        .confirm-delete-button {
            background-color: #ef4444;
            color: white;
        }
        .confirm-delete-button:hover {
            background-color: #dc2626;
        }
        .sector-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
            cursor: move;
        }
        .sector-item.dragging {
            opacity: 0.5;
            background-color: #e0f2fe;
        }
        footer {
            background-color: #1e3a8a;
            color: white;
            padding: 16px 0;
            text-align: center;
        }
        .search-controls {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 32px;
            align-items: center;
        }
        @media (min-width: 768px) {
            .search-controls {
                flex-direction: row;
                justify-content: center;
            }
            .search-bar {
                width: 50%;
            }
        }
        .spreadsheet-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }
        @media (min-width: 768px) {
            .spreadsheet-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (min-width: 1024px) {
            .spreadsheet-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div style="display: flex; align-items: center;">
                <img src="assets/P13sT7A.png" alt="LAMIC Logo" class="h-12 mr-4">
                <h1>Acervo de Planilhas LAMIC</h1>
            </div>
            <nav>
                <a href="https://drive.google.com/drive/folders/1Oq_6-RSzMyMSQn3PxFuwAgI8issN2Eqq" target="_blank" class="nav-item">Grupo LAMIC</a>
                <a href="https://drive.google.com/drive/folders/1dRlT62fBtdwYQkkpz5jm8bAAuJJwPM2d" target="_blank" class="nav-item">POP's</a>
                <a href="https://drive.google.com/drive/folders/1jyd1B7ylx1yvQkpmLqUgWCWD922fFFXT?usp=drive_open" target="_blank" class="nav-item">Documentos</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="search-controls">
            <input type="text" id="searchInput" placeholder="Buscar por título..." class="search-bar">
            <div class="dropdown">
                <button class="dropdown-button"><span id="selectedSector">Filtrar por Setor</span></button>
                <div id="sectorDropdown" class="dropdown-content">
                    <a href="#" onclick="filterBySector('')">Todos</a>
                    <a href="#" onclick="openModal('manageSectorsModal')">Gerenciar Setores</a>
                </div>
            </div>
            <button id="addSpreadsheetBtn" class="modern-button add-button">Adicionar Planilha</button>
            <button id="addSectorBtn" class="modern-button add-button">Adicionar Setor</button>
        </div>

        <div id="spreadsheetList" class="spreadsheet-grid"></div>
    </main>

    <div id="addSpreadsheetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addSpreadsheetModal')">&times;</span>
            <h2>Adicionar Nova Planilha</h2>
            <form id="addSpreadsheetForm">
                <label for="title">Título:</label>
                <input type="text" id="title" required>
                <label for="sector">Setor:</label>
                <select id="sector" required></select>
                <label for="link">Link:</label>
                <input type="url" id="link" required>
                <button type="submit" class="modern-button">Salvar</button>
            </form>
        </div>
    </div>

    <div id="editSpreadsheetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editSpreadsheetModal')">&times;</span>
            <h2>Editar Planilha</h2>
            <form id="editSpreadsheetForm">
                <input type="hidden" id="editIndex">
                <label for="editTitle">Título:</label>
                <input type="text" id="editTitle" required>
                <label for="editSector">Setor:</label>
                <select id="editSector" required></select>
                <label for="editLink">Link:</label>
                <input type="url" id="editLink" required>
                <button type="submit" class="modern-button">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <div id="addSectorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addSectorModal')">&times;</span>
            <h2>Adicionar Novo Setor</h2>
            <form id="addSectorForm">
                <label for="newSector">Nome do Setor:</label>
                <input type="text" id="newSector" required>
                <button type="submit" class="modern-button">Salvar</button>
            </form>
        </div>
    </div>

    <div id="manageSectorsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('manageSectorsModal')">&times;</span>
            <h2>Gerenciar Setores</h2>
            <p style="color: #6b7280; margin-bottom: 16px;">Arraste para reordenar os setores</p>
            <div id="sectorList"></div>
            <button onclick="closeModal('manageSectorsModal')" class="modern-button cancel-button">Fechar</button>
        </div>
    </div>

    <div id="confirmDeleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('confirmDeleteModal')">&times;</span>
            <h2>Confirmar Remoção</h2>
            <p>Tem certeza de que deseja remover esta planilha?</p>
            <div style="margin-top: 16px; display: flex; justify-content: flex-end; gap: 16px;">
                <button onclick="closeModal('confirmDeleteModal')" class="modern-button cancel-button">Cancelar</button>
                <button id="confirmDeleteBtn" class="modern-button confirm-delete-button">Remover</button>
            </div>
        </div>
    </div>

    <div id="confirmDeleteSectorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('confirmDeleteSectorModal')">&times;</span>
            <h2>Confirmar Remoção</h2>
            <p id="confirmDeleteSectorMessage"></p>
            <div style="margin-top: 16px; display: flex; justify-content: flex-end; gap: 16px;">
                <button onclick="closeModal('confirmDeleteSectorModal')" class="modern-button cancel-button">Cancelar</button>
                <button id="confirmDeleteSectorBtn" class="modern-button confirm-delete-button">Remover</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 Acervo de Planilhas LAMIC. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
            return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
            if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
                try {
                    var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];
                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                    var filteredData = jsonData.filter(row => row.some(filledCell));
                    var headerRowIndex = filteredData.findIndex((row, index) =>
                        row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                    );
                    if (headerRowIndex === -1 || headerRowIndex > 25) {
                        headerRowIndex = 0;
                    }
                    var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                    csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                    return csv;
                } catch (e) {
                    console.error(e);
                    return "";
                }
            }
            return gk_fileData[filename] || "";
        }

        let spreadsheets = JSON.parse(localStorage.getItem('spreadsheets')) || [];
        let sectors = JSON.parse(localStorage.getItem('sectors')) || ['Analítico', 'Atendimento', 'Pré-Analítico', 'Comercial', 'Adminstrativo', 'Tecnologia da Informação'];
        let deleteIndex = -1;
        let editIndex = -1;
        let deleteSectorName = '';
        let selectedSector = '';

        function saveData() {
            localStorage.setItem('spreadsheets', JSON.stringify(spreadsheets));
            localStorage.setItem('sectors', JSON.stringify(sectors));
        }

        function populateSectors() {
            const sectorSelect = document.getElementById('sector');
            const editSectorSelect = document.getElementById('editSector');
            const sectorDropdown = document.getElementById('sectorDropdown');
            sectorSelect.innerHTML = '';
            editSectorSelect.innerHTML = '';
            sectorDropdown.innerHTML = `
                <a href="#" onclick="filterBySector('')">Todos</a>
            `;
            sectors.forEach(sector => {
                const option = document.createElement('option');
                option.value = sector;
                option.textContent = sector;
                sectorSelect.appendChild(option);

                const editOption = document.createElement('option');
                editOption.value = sector;
                editOption.textContent = sector;
                editSectorSelect.appendChild(editOption);

                const a = document.createElement('a');
                a.href = '#';
                a.textContent = sector;
                a.onclick = () => filterBySector(sector);
                sectorDropdown.appendChild(a);
            });
            const manageLink = document.createElement('a');
            manageLink.href = '#';
            manageLink.textContent = 'Gerenciar Setores';
            manageLink.onclick = () => openModal('manageSectorsModal');
            sectorDropdown.appendChild(manageLink);
        }

        function populateSectorList() {
            const sectorList = document.getElementById('sectorList');
            sectorList.innerHTML = '';
            sectors.forEach(sector => {
                const div = document.createElement('div');
                div.className = 'sector-item';
                div.draggable = true;
                div.innerHTML = `
                    <span>${sector}</span>
                    <span class="delete-button" onclick="open CoinsDeleteSectorModal('${sector}')">X</span>
                `;
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragover', handleDragOver);
                div.addEventListener('drop', handleDrop);
                div.addEventListener('dragend', handleDragEnd);
                sectorList.appendChild(div);
            });
        }

        let draggedItem = null;

        function handleDragStart(e) {
            draggedItem = e.target;
            e.target.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const target = e.target.closest('.sector-item');
            if (draggedItem && target && draggedItem !== target) {
                const allItems = Array.from(document.querySelectorAll('.sector-item'));
                const draggedIndex = allItems.indexOf(draggedItem);
                const targetIndex = allItems.indexOf(target);
                const [removed] = sectors.splice(draggedIndex, 1);
                sectors.splice(targetIndex, 0, removed);
                saveData();
                populateSectors();
                populateSectorList();
            }
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedItem = null;
        }

        function renderCards() {
            const spreadsheetList = document.getElementById('spreadsheetList');
            spreadsheetList.innerHTML = '';
            spreadsheets.forEach((sheet, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.sector = sheet.sector;
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <h2>${sheet.title}</h2>
                        <div style="display: flex; flex-direction: column; align-items: flex-end;">
                            <span class="delete-button" onclick="openDeleteModal(${index})">X</span>
                            <span class="edit-button" onclick="openEditModal(${index})">&#9998;</span>
                        </div>
                    </div>
                    <p>Setor: ${sheet.sector}</p>
                    <a href="${sheet.link}" target="_blank" class="modern-button">Acessar Planilha</a>
                `;
                spreadsheetList.appendChild(card);
            });
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            if (modalId === 'manageSectorsModal') {
                populateSectorList();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function openDeleteModal(index) {
            deleteIndex = index;
            openModal('confirmDeleteModal');
        }

        function openEditModal(index) {
            editIndex = index;
            const sheet = spreadsheets[index];
            document.getElementById('editTitle').value = sheet.title;
            document.getElementById('editSector').value = sheet.sector;
            document.getElementById('editLink').value = sheet.link;
            openModal('editSpreadsheetModal');
        }

        function openDeleteSectorModal(sector) {
            const isUsed = spreadsheets.some(sheet => sheet.sector === sector);
            const messageElement = document.getElementById('confirmDeleteSectorMessage');
            if (isUsed) {
                messageElement.textContent = `Não é possível remover o setor "${sector}" porque ele está sendo usado por uma ou mais planilhas.`;
                document.getElementById('confirmDeleteSectorBtn').style.display = 'none';
            } else {
                messageElement.textContent = `Tem certeza de que deseja remover o setor "${sector}"?`;
                document.getElementById('confirmDeleteSectorBtn').style.display = 'inline-block';
                deleteSectorName = sector;
            }
            openModal('confirmDeleteSectorModal');
        }

        document.getElementById('addSpreadsheetBtn').addEventListener('click', () => openModal('addSpreadsheetModal'));

        document.getElementById('addSectorBtn').addEventListener('click', () => openModal('addSectorModal'));

        document.getElementById('addSpreadsheetForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('title').value;
            const sector = document.getElementById('sector').value;
            const link = document.getElementById('link').value;
            spreadsheets.push({ title, sector, link });
            saveData();
            renderCards();
            closeModal('addSpreadsheetModal');
            document.getElementById('addSpreadsheetForm').reset();
        });

        document.getElementById('editSpreadsheetForm').addEventListener('submit', (e) => {
            e.preventDefault();
            if (editIndex !== -1) {
                spreadsheets[editIndex].title = document.getElementById('editTitle').value;
                spreadsheets[editIndex].sector = document.getElementById('editSector').value;
                spreadsheets[editIndex].link = document.getElementById('editLink').value;
                saveData();
                renderCards();
                editIndex = -1;
            }
            closeModal('editSpreadsheetModal');
        });

        document.getElementById('addSectorForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const newSector = document.getElementById('newSector').value;
            if (!sectors.includes(newSector)) {
                sectors.push(newSector);
                saveData();
                populateSectors();
                populateSectorList();
            }
            closeModal('addSectorModal');
            document.getElementById('addSectorForm').reset();
        });

        document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
            if (deleteIndex !== -1) {
                spreadsheets.splice(deleteIndex, 1);
                saveData();
                renderCards();
                deleteIndex = -1;
            }
            closeModal('confirmDeleteModal');
        });

        document.getElementById('confirmDeleteSectorBtn').addEventListener('click', () => {
            if (deleteSectorName) {
                sectors = sectors.filter(sector => sector !== deleteSectorName);
                saveData();
                populateSectors();
                populateSectorList();
                deleteSectorName = '';
            }
            closeModal('confirmDeleteSectorModal');
        });

        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const cards = document.getElementsByClassName('card');
            Array.from(cards).forEach(card => {
                const title = card.querySelector('h2').textContent.toLowerCase();
                const cardSector = card.getAttribute('data-sector');
                const matchesSearch = title.includes(searchTerm);
                const matchesSector = selectedSector === '' || cardSector === selectedSector;
                card.style.display = matchesSearch && matchesSector ? '' : 'none';
            });
        });

        function filterBySector(sector) {
            selectedSector = sector;
            document.getElementById('selectedSector').textContent = sector || 'Filtrar por Setor';
            const cards = document.getElementsByClassName('card');
            const searchTerm = searchInput.value.toLowerCase();
            Array.from(cards).forEach(card => {
                const title = card.querySelector('h2').textContent.toLowerCase();
                const cardSector = card.getAttribute('data-sector');
                const matchesSearch = title.includes(searchTerm);
                const matchesSector = sector === '' || cardSector === sector;
                card.style.display = matchesSearch && matchesSector ? '' : 'none';
            });
        }

        populateSectors();
        populateSectorList();
        renderCards();
    </script>
</body>
</html>